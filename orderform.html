<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Custom Cookies | Rebel Ribbon</title>
  <meta name="description" content="Order custom decorated cookies for your next event. Handmade with love by two sisters in San Antonio, TX.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --pink: #F4B4B8;
      --pink-light: #FAE0E2;
      --pink-soft: #FFF8F8;
      --rose: #E8A0A4;
      --brown: #5D4E4E;
      --brown-light: #7A6B6B;
      --cream: #FFFCFB;
      --white: #FFFFFF;
      --error: #c94a4a;
      --success: #5a9a6e;
      
      --font-display: 'Playfair Display', serif;
      --font-body: 'Nunito', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font-body);
      background: var(--cream);
      color: var(--brown);
      line-height: 1.6;
      overflow-x: hidden;
    }

    img { max-width: 100%; display: block; }
    a { color: inherit; text-decoration: none; }

    .container {
      width: 90%;
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: var(--cream);
      padding: 1rem 0;
      transition: box-shadow 0.3s ease;
    }

    header.scrolled {
      box-shadow: 0 2px 20px rgba(93, 78, 78, 0.08);
    }

    header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo img { height: 36px; }

    .logo span {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--brown);
    }

    nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    nav a {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--brown-light);
      transition: color 0.2s;
    }

    nav a:hover { color: var(--rose); }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: var(--pink);
      color: var(--brown);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
      font-family: var(--font-body);
    }

    .btn:hover {
      background: var(--rose);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-primary {
      background: var(--brown);
      color: var(--white);
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      box-shadow: 0 8px 30px rgba(93, 78, 78, 0.2);
    }

    .btn-primary:hover {
      background: var(--brown-light);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .mobile-menu {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      padding: 8px;
    }

    .mobile-menu span {
      width: 22px;
      height: 2px;
      background: var(--brown);
      border-radius: 2px;
    }

    @media (max-width: 768px) {
      .mobile-menu { display: flex; }
      
      nav {
        position: fixed;
        top: 0;
        right: -100%;
        width: 70%;
        max-width: 280px;
        height: 100vh;
        background: var(--white);
        flex-direction: column;
        justify-content: center;
        gap: 1.5rem;
        transition: right 0.3s ease;
        box-shadow: -5px 0 30px rgba(0,0,0,0.1);
      }
      
      nav.open { right: 0; }
      nav a { font-size: 1.1rem; }
    }

    /* Page Hero */
    .page-hero {
      padding: 160px 0 80px;
      background: linear-gradient(135deg, var(--pink-soft) 0%, var(--pink-light) 50%, var(--cream) 100%);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .page-hero::before {
      content: '';
      position: absolute;
      top: -30%;
      right: -10%;
      width: 50%;
      height: 70%;
      background: radial-gradient(ellipse, var(--pink) 0%, transparent 70%);
      opacity: 0.3;
      pointer-events: none;
    }

    .page-hero .container {
      position: relative;
      z-index: 1;
    }

    .page-hero h1 {
      font-family: var(--font-display);
      font-size: clamp(2.25rem, 5vw, 3.5rem);
      color: var(--brown);
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .page-hero h1 span {
      display: block;
      font-style: italic;
      font-weight: 400;
      color: var(--rose);
      font-size: 0.7em;
    }

    .page-hero p {
      font-size: 1.1rem;
      color: var(--brown-light);
      max-width: 550px;
      margin: 0 auto;
    }

    /* Form Section */
    .form-section {
      padding: 4rem 0 5rem;
    }

    .form-wrapper {
      max-width: 720px;
      margin: 0 auto;
    }

    .form-card {
      background: var(--white);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 10px 50px rgba(93, 78, 78, 0.08);
    }

    @media (max-width: 600px) {
      .form-card { padding: 1.5rem; }
    }

    /* Form Group Styles */
    .form-block {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--pink-light);
    }

    .form-block:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .form-block-title {
      font-family: var(--font-display);
      font-size: 1.35rem;
      color: var(--brown);
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .form-block-title svg {
      width: 24px;
      height: 24px;
      stroke: var(--rose);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 550px) {
      .form-row { grid-template-columns: 1fr; }
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--brown);
      margin-bottom: 0.5rem;
    }

    .label-tag {
      font-size: 0.7rem;
      font-weight: 500;
      background: var(--pink-soft);
      color: var(--brown-light);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      margin-left: 0.5rem;
      vertical-align: middle;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--pink-light);
      border-radius: 12px;
      font-family: var(--font-body);
      font-size: 1rem;
      color: var(--brown);
      background: var(--white);
      transition: all 0.2s ease;
      appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%235D4E4E' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 2.5rem;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--rose);
      box-shadow: 0 0 0 4px rgba(232, 160, 164, 0.15);
    }

    input::placeholder, textarea::placeholder {
      color: var(--brown-light);
      opacity: 0.6;
    }

    input[type="file"] {
      padding: 0.75rem;
      font-size: 0.9rem;
    }

    input[type="file"]::file-selector-button {
      background: var(--pink);
      color: var(--brown);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 1rem;
      transition: background 0.2s;
    }

    input[type="file"]::file-selector-button:hover {
      background: var(--rose);
    }

    /* Checkbox */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--pink-soft);
      border-radius: 12px;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .checkbox-group:hover {
      background: var(--pink-light);
    }

    .checkbox-group input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: var(--rose);
      cursor: pointer;
    }

    .checkbox-group label {
      margin: 0;
      font-weight: 500;
      cursor: pointer;
    }

    /* Address fields */
    #addressFields {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 2px dashed var(--pink-light);
    }

    /* Codes Section */
    .code-input-group {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
    }

    .code-input-group input {
      flex: 1;
    }

    .code-message {
      display: block;
      font-size: 0.8rem;
      margin-top: 0.4rem;
      min-height: 1.2rem;
    }

    .code-message.success { color: var(--success); }
    .code-message.error { color: var(--error); }

    /* Estimate Box */
    .estimate-box {
      background: linear-gradient(135deg, var(--pink-soft) 0%, var(--pink-light) 100%);
      padding: 1.5rem;
      border-radius: 16px;
      font-size: 0.95rem;
    }

    .estimate-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      color: var(--brown-light);
    }

    .estimate-total {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--brown);
      padding-top: 1rem;
      margin-top: 0.75rem;
      border-top: 2px solid rgba(93, 78, 78, 0.1);
    }

    .estimate-note {
      font-size: 0.8rem;
      color: var(--brown-light);
      margin-top: 1rem;
      font-style: italic;
    }

    /* Submit Section */
    .form-actions {
      margin-top: 2rem;
      text-align: center;
    }

    .form-actions .btn-primary {
      width: 100%;
      max-width: 320px;
    }

    .form-message {
      margin-top: 1rem;
      font-weight: 600;
      min-height: 1.5rem;
    }

    .form-message.error { color: var(--error); }
    .form-message.success { color: var(--success); }

    /* Footer */
    footer {
      background: var(--cream);
      padding: 4rem 0 2rem;
      border-top: 1px solid var(--pink-light);
    }

    .footer-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .footer-brand .logo { margin-bottom: 1rem; }

    .footer-brand p {
      color: var(--brown-light);
      font-size: 0.95rem;
      max-width: 280px;
    }

    .footer-social {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.25rem;
    }

    .footer-social a {
      width: 38px;
      height: 38px;
      background: var(--pink-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .footer-social a:hover {
      background: var(--pink);
      transform: translateY(-2px);
    }

    .footer-col h4 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--brown);
    }

    .footer-col ul { list-style: none; }
    .footer-col li { margin-bottom: 0.6rem; }

    .footer-col a {
      font-size: 0.95rem;
      color: var(--brown-light);
      transition: color 0.2s;
    }

    .footer-col a:hover { color: var(--rose); }

    .footer-bottom {
      text-align: center;
      padding-top: 2rem;
      border-top: 1px solid var(--pink-light);
      font-size: 0.9rem;
      color: var(--brown-light);
    }

    @media (max-width: 768px) {
      .footer-grid { grid-template-columns: 1fr 1fr; }
      .footer-brand { grid-column: span 2; }
    }

    @media (max-width: 480px) {
      .footer-grid { grid-template-columns: 1fr; }
      .footer-brand { grid-column: span 1; }
    }

  </style>
</head>
<body>

  <!-- Header -->
  <header id="header">
    <div class="container">
      <a href="index.html" class="logo">
        <img src="Bow.png" alt="Rebel Ribbon">
        <span>Rebel Ribbon</span>
      </a>
      
      <div class="mobile-menu" onclick="toggleNav()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      
      <nav id="nav">
        <a href="index.html#about">About</a>
        <a href="gallery.html">Gallery</a>
        <a href="index.html#how">How It Works</a>
        <a href="index.html#contact">Contact</a>
        <a href="order.html" class="btn">Order Cookies</a>
      </nav>
    </div>
  </header>

  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <h1>Place Your Order <span>Let us create something sweet for you</span></h1>
      <p>Fill out the form below and we will confirm your details, pricing, and design within 48 hours.</p>
    </div>
  </section>

  <!-- Order Form -->
  <section class="form-section">
    <div class="container">
      <div class="form-wrapper">
        <div class="form-card">
          <form id="orderForm" novalidate>

            <!-- Contact Info -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
                Your Information
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="first_name">First Name <span class="label-tag">Required</span></label>
                  <input type="text" id="first_name" required>
                </div>
                <div class="form-group">
                  <label for="last_name">Last Name <span class="label-tag">Required</span></label>
                  <input type="text" id="last_name" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email <span class="label-tag">Required</span></label>
                  <input type="email" id="email" required>
                </div>
                <div class="form-group">
                  <label for="phone">Phone <span class="label-tag">Required</span></label>
                  <input type="tel" id="phone" required>
                </div>
              </div>
            </div>

            <!-- Delivery/Pickup -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                </svg>
                Delivery or Pickup
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="pickup_delivery_type">Method <span class="label-tag">Required</span></label>
                  <select id="pickup_delivery_type" required>
                    <option value="">Select...</option>
                    <option value="Pickup">Pickup</option>
                    <option value="Delivery">Delivery</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="pickup_delivery_date">Pickup/Delivery Date <span class="label-tag">Min 5 days</span></label>
                  <input type="date" id="pickup_delivery_date" required>
                </div>
              </div>
              
              <!-- Address Fields (Hidden by default) -->
              <div id="addressFields" style="display:none;">
                <div class="form-group">
                  <label for="street_address">Street Address <span class="label-tag">Required for Delivery</span></label>
                  <input type="text" id="street_address">
                </div>
                <div class="form-group">
                  <label for="street_address_cont">Apt / Suite</label>
                  <input type="text" id="street_address_cont">
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city">
                  </div>
                  <div class="form-group">
                    <label for="state">State</label>
                    <input type="text" id="state">
                  </div>
                </div>
                <div class="form-group">
                  <label for="zip">Zip Code</label>
                  <input type="text" id="zip">
                </div>
              </div>
            </div>

            <!-- Order Details -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                </svg>
                Order Details
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="event_date">Event Date <span class="label-tag">Min 5 days</span></label>
                  <input type="date" id="event_date" required>
                </div>
                <div class="form-group">
                  <label for="event_type_name">Event Type <span class="label-tag">Required</span></label>
                  <input type="text" id="event_type_name" placeholder="Birthday, Wedding, Baby Shower..." required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="cookie_amount_dzns">How Many Dozen? <span class="label-tag">Required</span></label>
                  <input type="number" id="cookie_amount_dzns" min="1" step="0.5" placeholder="1">
                </div>
                <div class="form-group">
                  <label for="flavor">Flavor <span class="label-tag">Required</span></label>
                  <select id="flavor" required>
                    <option value="">Loading...</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="dietary_option">Dietary Option</label>
                <select id="dietary_option">
                  <option value="">None</option>
                </select>
              </div>
              <div class="form-group">
                <label for="design_notes">Design Notes <span class="label-tag">Required</span></label>
                <textarea id="design_notes" placeholder="Tell us about your theme, colors, any specific details you want..." required></textarea>
              </div>
              <div class="form-group">
                <label for="design_inspiration_photo">Inspiration Photo</label>
                <input type="file" id="design_inspiration_photo" accept="image/*">
              </div>
            </div>

            <!-- Extras -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                </svg>
                Extras
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="gift_note">
                <label for="gift_note">Add a gift note?</label>
              </div>
              <div class="form-group" id="gift_note_text_group" style="display:none;">
                <label for="gift_note_text">Gift Message</label>
                <textarea id="gift_note_text" placeholder="Write your message here..."></textarea>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="consultation_requested">
                <label for="consultation_requested">Request a design consultation?</label>
              </div>
            </div>

            <!-- Codes -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                </svg>
                Discount and Referral Codes
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="discount_code_used">Discount Code</label>
                  <div class="code-input-group">
                    <input type="text" id="discount_code_used" placeholder="Enter code">
                    <button type="button" id="applyDiscountButton" class="btn btn-small">Apply</button>
                  </div>
                  <small id="discountHelp" class="code-message"></small>
                </div>
                <div class="form-group">
                  <label for="referral_code_used">Referral Code</label>
                  <div class="code-input-group">
                    <input type="text" id="referral_code_used" placeholder="Enter code">
                    <button type="button" id="applyReferralButton" class="btn btn-small">Apply</button>
                  </div>
                  <small id="referralHelp" class="code-message"></small>
                </div>
              </div>
            </div>

            <!-- Estimate -->
            <div class="form-block">
              <div class="form-block-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                </svg>
                Estimated Total
              </div>
              <div id="estimateBox" class="estimate-box">
                Enter your order details above to see your estimate.
              </div>
            </div>

            <!-- Submit -->
            <div class="form-actions">
              <button type="submit" id="submitButton" class="btn btn-primary">Submit Order Request</button>
              <p id="formMessage" class="form-message"></p>
            </div>

          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="logo">
            <img src="Bow.png" alt="Rebel Ribbon" style="height: 32px;">
            <span>Rebel Ribbon</span>
          </div>
          <p>Custom decorated cookies made by two sisters in San Antonio, Texas. Every cookie is a little work of art.</p>
          <div class="footer-social">
            <a href="https://instagram.com/rebelribbon" aria-label="Instagram">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
            </a>
            <a href="https://facebook.com/rebelribbon" aria-label="Facebook">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Pages</h4>
          <ul>
            <li><a href="index.html#about">About Us</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="order.html">Order</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Info</h4>
          <ul>
            <li><a href="ingredients.html">Ingredients</a></li>
            <li><a href="privacy.html">Privacy</a></li>
            <li><a href="terms.html">Terms</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Contact</h4>
          <ul>
            <li><a href="mailto:info@rebelribbon.com">info@rebelribbon.com</a></li>
            <li><a href="tel:2102397471">(210) 239-7471</a></li>
            <li>San Antonio, TX</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        Â© 2025 Rebel Ribbon. Made with love in San Antonio.
      </div>
    </div>
  </footer>

  <!-- Supabase & Logic -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.0"></script>
  <script>
    // Debug Logger (console only)
    const debugLog = (msg) => {
      console.log(msg);
    };

    // Toggle Nav
    function toggleNav() {
      document.getElementById('nav').classList.toggle('open');
    }

    // Header scroll effect
    window.addEventListener('scroll', () => {
      document.getElementById('header').classList.toggle('scrolled', window.scrollY > 50);
    });

    // Supabase Setup
    const SUPABASE_URL = "https://zyntkwammltmjjvgelwg.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5bnRrd2FtbWx0bWpqdmdlbHdnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MzkxNjYsImV4cCI6MjA3ODExNTE2Nn0.eLkkGBuSRNUd7P7mJT5Be-dsvVjGBZ9pkupQq6KGT9A";
    
    debugLog("Initializing Supabase client...");
    const { createClient } = supabase;
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    debugLog("Supabase client created");
    
    let currentPricing = null;
    let appliedDiscount = { type: null, amount: 0, label: "" };
    let appliedReferral = { type: null, amount: 0, label: "" };
    
    // Helpers
    function generateNumericId(length) {
      let result = "";
      for (let i = 0; i < length; i++) result += Math.floor(Math.random() * 10).toString();
      return result;
    }
    function formatMoney(amount) {
      return "$" + (amount || 0).toFixed(2);
    }
    function getDaysFromToday(dateStr) {
      if (!dateStr) return null;
      const parts = dateStr.split("-");
      if (parts.length !== 3) return null;
      const year = Number(parts[0]);
      const month = Number(parts[1]);
      const day = Number(parts[2]);
      if (!year || !month || !day) return null;
      const now = new Date();
      const todayUtc = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate());
      const targetUtc = Date.UTC(year, month - 1, day);
      return Math.floor((targetUtc - todayUtc) / 86400000);
    }
    function getRelativeDateStr(daysOffset) {
      const now = new Date();
      const targetUtc = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + daysOffset));
      const year = targetUtc.getUTCFullYear();
      const month = String(targetUtc.getUTCMonth() + 1).padStart(2, "0");
      const day = String(targetUtc.getUTCDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }
    function generateReferralCode(firstName, lastName) {
      const firstPart = (firstName || "").trim().toUpperCase().slice(0, 3).padEnd(3, "X");
      const lastPart = (lastName || "").trim().toUpperCase().slice(0, 3).padEnd(3, "X");
      const numbers = generateNumericId(3);
      return firstPart + lastPart + numbers;
    }
    async function generateUniqueReferralCode(firstName, lastName) {
      let attempt = 0;
      while (attempt < 5) {
        const code = generateReferralCode(firstName, lastName);
        const { data, error } = await sb.from("referral_codes").select("id").eq("code", code).limit(1);
        if (!error && (!data || data.length === 0)) return code;
        attempt++;
      }
      return "REF" + generateNumericId(6);
    }
    
    // Load Data
    async function init() {
      debugLog("Starting init()...");
      
      // Load Flavors
      debugLog("Loading flavors...");
      const flavorSelect = document.getElementById("flavor");
      const { data: flavors, error: flavorError } = await sb.from("flavors").select("name").order("name");
      if (flavorError) debugLog("ERROR loading flavors: " + flavorError.message);
      else debugLog("Loaded " + (flavors?.length || 0) + " flavors");
      flavorSelect.innerHTML = '<option value="">Select Flavor</option>';
      if (flavors) flavors.forEach(f => flavorSelect.innerHTML += `<option value="${f.name}">${f.name}</option>`);
      
      // Load Dietary
      debugLog("Loading dietary options...");
      const dietarySelect = document.getElementById("dietary_option");
      const { data: diets, error: dietError } = await sb.from("dietary_options").select("name").order("name");
      if (dietError) debugLog("ERROR loading dietary: " + dietError.message);
      else debugLog("Loaded " + (diets?.length || 0) + " dietary options");
      dietarySelect.innerHTML = '<option value="">None</option>';
      if (diets) diets.forEach(d => dietarySelect.innerHTML += `<option value="${d.name}">${d.name}</option>`);
      
      // Load Pricing
      debugLog("Loading pricing...");
      const box = document.getElementById("estimateBox");
      const { data: priceData, error: priceError } = await sb.from("pricing").select("*").order("created_at", {ascending:false}).limit(1).maybeSingle();
      if (priceError) debugLog("ERROR loading pricing: " + priceError.message);
      else if (priceData) {
        debugLog("Loaded pricing: $" + priceData.price_per_dozen + " per dozen");
        currentPricing = {
          price_per_dozen: Number(priceData.price_per_dozen),
          delivery_fee: Number(priceData.delivery_fee),
          consultation_fee: Number(priceData.consultation_fee),
          gift_note_fee: Number(priceData.gift_note_fee),
          rush_fee: Number(priceData.rush_fee)
        };
        updateEstimate();
      } else {
        debugLog("No pricing data found");
        box.innerHTML = "<div class='estimate-note'>Pricing is not available right now. We will send your quote manually.</div>";
      }
      
      debugLog("Init complete");
    }
    
    // UI Logic
    function updateAddressVisibility() {
      const typeSelect = document.getElementById("pickup_delivery_type");
      const addressFields = document.getElementById("addressFields");
      if (!typeSelect || !addressFields) return;
      if (typeSelect.value === "Delivery") {
        addressFields.style.display = "block";
      } else {
        addressFields.style.display = "none";
        ["street_address","street_address_cont","city","state","zip"].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = "";
        });
      }
    }
    
    function updateEstimate() {
      const box = document.getElementById("estimateBox");
      if (!currentPricing) return;
      
      const qty = parseFloat(document.getElementById("cookie_amount_dzns").value) || 0;
      const isDelivery = document.getElementById("pickup_delivery_type").value === "Delivery";
      const isConsult = document.getElementById("consultation_requested").checked;
      const isGift = document.getElementById("gift_note").checked;
      const dateVal = document.getElementById("pickup_delivery_date").value;
      
      const pricePerDozen = parseFloat(currentPricing.price_per_dozen || 0);
      const deliveryFee = parseFloat(currentPricing.delivery_fee || 0);
      const consultFee = parseFloat(currentPricing.consultation_fee || 0);
      const giftNoteFee = parseFloat(currentPricing.gift_note_fee || 0);
      const rushFee = parseFloat(currentPricing.rush_fee || 0);
      
      const baseSubtotal = qty * pricePerDozen;
      const deliveryCharge = isDelivery ? deliveryFee : 0;
      const consultCharge = isConsult ? consultFee : 0;
      const giftCharge = isGift ? giftNoteFee : 0;
      
      let rushCharge = 0;
      const daysOut = getDaysFromToday(dateVal);
      if (daysOut !== null && daysOut >= 0 && daysOut <= 10) rushCharge = rushFee;
      
      const totalBeforeDiscount = baseSubtotal + deliveryCharge + consultCharge + giftCharge + rushCharge;
      
      let discountTotal = 0;
      let discountLines = "";
      
      if (appliedDiscount && appliedDiscount.amount > 0) {
        let discountAmount = appliedDiscount.type === "percent" ? totalBeforeDiscount * (appliedDiscount.amount / 100) : appliedDiscount.amount;
        discountTotal += discountAmount;
        discountLines += `<div class='estimate-row'><span>${appliedDiscount.label || "Discount"}</span><span>-${formatMoney(discountAmount)}</span></div>`;
      }
      if (appliedReferral && appliedReferral.amount > 0) {
        let referralAmount = appliedReferral.type === "percent" ? totalBeforeDiscount * (appliedReferral.amount / 100) : appliedReferral.amount;
        discountTotal += referralAmount;
        discountLines += `<div class='estimate-row'><span>${appliedReferral.label || "Referral discount"}</span><span>-${formatMoney(referralAmount)}</span></div>`;
      }
      if (discountTotal > totalBeforeDiscount) discountTotal = totalBeforeDiscount;
      
      const totalAfterDiscount = totalBeforeDiscount - discountTotal;
      
      let html = `<div class='estimate-row'><span>Cookies (${qty || 0} dz @ ${formatMoney(pricePerDozen)})</span><span>${formatMoney(baseSubtotal)}</span></div>`;
      if (deliveryCharge > 0) html += `<div class='estimate-row'><span>Delivery Fee</span><span>${formatMoney(deliveryCharge)}</span></div>`;
      if (consultCharge > 0) html += `<div class='estimate-row'><span>Design Consultation</span><span>${formatMoney(consultCharge)}</span></div>`;
      if (giftCharge > 0) html += `<div class='estimate-row'><span>Gift Note</span><span>${formatMoney(giftCharge)}</span></div>`;
      if (rushCharge > 0) html += `<div class='estimate-row'><span>Rush Fee (under 10 days)</span><span>${formatMoney(rushCharge)}</span></div>`;
      if (discountLines) html += discountLines;
      html += `<div class='estimate-total'><span>Estimated Total</span><span>${formatMoney(totalAfterDiscount)}</span></div>`;
      html += "<div class='estimate-note'>This is an estimate. Final pricing will be confirmed when we reach out.</div>";
      
      box.innerHTML = html;
    }
    
    // Discount Functions
    async function applyDiscount() {
      const discountHelp = document.getElementById("discountHelp");
      const discountCode = document.getElementById("discount_code_used").value.trim();
      appliedDiscount = { type: null, amount: 0, label: "" };
      discountHelp.className = "code-message";
      
      if (discountCode) {
        debugLog("Checking discount code: " + discountCode);
        const { data: disc, error } = await sb.from("discount_codes").select("*").eq("code", discountCode).maybeSingle();
        if (error) {
          debugLog("ERROR checking discount: " + error.message);
          discountHelp.textContent = "Error checking code.";
          discountHelp.classList.add("error");
        } else if (disc) {
          debugLog("Discount found");
          appliedDiscount = { type: "percent", amount: 10, label: "Discount (10%)" };
          discountHelp.textContent = "Discount applied!";
          discountHelp.classList.add("success");
        } else {
          debugLog("Discount not found");
          discountHelp.textContent = "Code not found.";
          discountHelp.classList.add("error");
        }
      } else {
        discountHelp.textContent = "";
      }
      updateEstimate();
    }
    
    async function applyReferral() {
      const referralHelp = document.getElementById("referralHelp");
      const referralCode = document.getElementById("referral_code_used").value.trim();
      appliedReferral = { type: null, amount: 0, label: "" };
      referralHelp.className = "code-message";
      
      if (referralCode) {
        debugLog("Checking referral code: " + referralCode);
        const { data: ref, error } = await sb.from("referral_codes").select("*").eq("code", referralCode).maybeSingle();
        if (error) {
          debugLog("ERROR checking referral: " + error.message);
          referralHelp.textContent = "Error checking code.";
          referralHelp.classList.add("error");
        } else if (ref) {
          debugLog("Referral found");
          appliedReferral = { type: "percent", amount: 5, label: "Referral (5%)" };
          referralHelp.textContent = "Referral applied!";
          referralHelp.classList.add("success");
        } else {
          debugLog("Referral not found");
          referralHelp.textContent = "Code not found.";
          referralHelp.classList.add("error");
        }
      } else {
        referralHelp.textContent = "";
      }
      updateEstimate();
    }
    
    // Submission
    async function handleOrderSubmit(event) {
      event.preventDefault();
      debugLog("===== FORM SUBMISSION STARTED =====");
      
      const submitButton = document.getElementById("submitButton");
      const messageEl = document.getElementById("formMessage");
      messageEl.textContent = "";
      messageEl.className = "form-message";
      
      // Required fields
      const requiredIds = ["first_name", "last_name", "email", "phone", "pickup_delivery_type", "pickup_delivery_date", "event_date", "event_type_name", "cookie_amount_dzns", "flavor", "design_notes"];
      let missing = [];
      requiredIds.forEach(id => {
        const el = document.getElementById(id);
        if (el && !el.value.trim()) missing.push(id);
      });
      
      const pickupTypeVal = document.getElementById("pickup_delivery_type").value;
      if (pickupTypeVal === "Delivery") {
        ["street_address", "city", "state", "zip"].forEach(id => {
          const el = document.getElementById(id);
          if (el && !el.value.trim()) missing.push(id);
        });
      }
      
      const giftNoteCheckbox = document.getElementById("gift_note");
      const giftNoteTextEl = document.getElementById("gift_note_text");
      if (giftNoteCheckbox && giftNoteCheckbox.checked && !giftNoteTextEl.value.trim()) {
        missing.push("gift_note_text");
      }
      
      if (missing.length > 0) {
        debugLog("Missing required fields: " + missing.join(", "));
        messageEl.textContent = "Please fill in all required fields.";
        messageEl.classList.add("error");
        return;
      }
      
      // Date validation
      const pickup_delivery_date = document.getElementById("pickup_delivery_date").value;
      const event_date_value = document.getElementById("event_date").value;
      const daysToPickup = getDaysFromToday(pickup_delivery_date);
      const daysToEvent = getDaysFromToday(event_date_value);
      
      debugLog("Days to pickup: " + daysToPickup);
      debugLog("Days to event: " + daysToEvent);
      
      if (daysToPickup === null || daysToPickup < 5) {
        debugLog("Pickup date validation failed");
        messageEl.textContent = "Pickup date must be at least 5 days from today.";
        messageEl.classList.add("error");
        return;
      }
      if (daysToEvent === null || daysToEvent < 5 || daysToEvent < daysToPickup) {
        debugLog("Event date validation failed");
        messageEl.textContent = "Event date must be after the pickup date and at least 5 days out.";
        messageEl.classList.add("error");
        return;
      }
      
      submitButton.disabled = true;
      submitButton.textContent = "Submitting...";
      
      try {
        debugLog("Collecting form data...");
        
        const getVal = (id) => {
          const el = document.getElementById(id);
          if (!el) {
            debugLog(`getVal(${id}): ELEMENT NOT FOUND`);
            return null;
          }
          const val = el.value?.trim();
          debugLog(`getVal(${id}): "${val}" (length: ${val?.length || 0})`);
          return val || null;
        };
        
        const first_name = getVal("first_name");
        const last_name = getVal("last_name");
        const email = getVal("email");
        const phone = getVal("phone");
        const street_address = getVal("street_address");
        const street_address_cont = getVal("street_address_cont");
        const city = getVal("city");
        const state = getVal("state");
        const zip = getVal("zip");
        const cookie_amount_dzns_raw = getVal("cookie_amount_dzns");
        const cookie_amount_dzns = cookie_amount_dzns_raw ? parseFloat(cookie_amount_dzns_raw) : null;
        
        debugLog("Customer: " + first_name + " " + last_name + " (" + email + ")");
        debugLog("Phone: " + phone);
        debugLog("Cookies: " + cookie_amount_dzns + " dozen");
        
        if (!cookie_amount_dzns || Number.isNaN(cookie_amount_dzns) || cookie_amount_dzns <= 0) {
          debugLog("Invalid cookie quantity");
          messageEl.textContent = "Please enter a valid cookie quantity.";
          messageEl.classList.add("error");
          submitButton.disabled = false;
          submitButton.textContent = "Submit Order Request";
          return;
        }
        
        const dietary_option = getVal("dietary_option");
        const design_notes = getVal("design_notes");
        const gift_note = document.getElementById("gift_note").checked;
        const gift_note_text = gift_note ? getVal("gift_note_text") : null;
        const consultation_requested = document.getElementById("consultation_requested").checked;
        const discount_code_used = getVal("discount_code_used");
        const referral_code_used = getVal("referral_code_used");
        let design_inspiration_photo = null;
        
        // Customer lookup or create
        debugLog("Looking up customer by email...");
        let customerId = null;
        const { data: existingCustomers, error: lookupErr } = await sb.from("customers").select("id").eq("email", email);
        
        if (lookupErr) {
          debugLog("ERROR looking up customer: " + lookupErr.message);
          throw new Error("Customer lookup error: " + lookupErr.message);
        }
        
        if (existingCustomers?.length) {
          customerId = existingCustomers[0].id;
          debugLog("Found existing customer: " + customerId);
        } else {
          debugLog("Creating new customer...");
          debugLog("Customer data being inserted: " + JSON.stringify({first_name, last_name, email, phone, street_address, street_address_cont, city, state, zip}));
          
          const { data: newCustomer, error: custErr } = await sb.from("customers").insert([{
            first_name, last_name, email, phone,
            street_address, street_address_cont, city, state, zip,
            customer_id: generateNumericId(7)
          }]).select("id").single();
          
          if (custErr) {
            debugLog("ERROR creating customer: " + JSON.stringify(custErr));
            throw new Error("Customer Insert Error: " + custErr.message);
          }
          customerId = newCustomer.id;
          debugLog("Created new customer: " + customerId);
        }
        
        // Referral code creation
        try {
          debugLog("Creating referral code...");
          const referralCode = await generateUniqueReferralCode(first_name, last_name);
          await sb.from("referral_codes").insert([{ code: referralCode, associated_customer_id: customerId }]);
          debugLog("Referral code created: " + referralCode);
        } catch (refErr) {
          debugLog("Referral creation failed (non critical): " + refErr.message);
        }
        
        // File upload
        const fileInput = document.getElementById('design_inspiration_photo');
        if (fileInput.files?.[0]) {
          try {
            debugLog("Uploading photo...");
            const file = fileInput.files[0];
            const ext = file.name.split('.').pop();
            const uploadFolderId = generateNumericId(9);
            const path = `inspirations/${uploadFolderId}_${Date.now()}.${ext}`;

            const { data: uploadData, error: uploadErr } = await sb.storage.from('order_uploads').upload(path, file);
            
            if (uploadErr) {
              debugLog("Photo upload error: " + uploadErr.message);
              throw new Error('Upload failed: ' + uploadErr.message);
            }
            
            const { data: urlData } = sb.storage.from('order_uploads').getPublicUrl(path);
            design_inspiration_photo = urlData?.publicUrl || null;
            debugLog("Photo URL generated: " + design_inspiration_photo);
          } catch (uploadErr) {
            debugLog("Photo upload failed: " + uploadErr.message);
          }
        }
        
        debugLog("Building order payload...");
        const orderPayload = {
          order_id: generateNumericId(9),
          customer_id: customerId,
          pickup_delivery_type: getVal("pickup_delivery_type"),
          pickup_delivery_date,
          event_date: event_date_value,
          event_type_name: getVal("event_type_name"),
          cookie_amount_dzns,
          flavor: getVal("flavor"),
          dietary_option,
          design_notes,
          design_inspiration_photo,
          gift_note,
          gift_note_text,
          consultation_requested,
          discount_code_used,
          referral_code_used,
          status: "In Review"
        };
        
        debugLog("Order payload: " + JSON.stringify(orderPayload));
        debugLog("Inserting order into database...");
        
        const { error: ordErr, data: newOrder } = await sb.from("orders").insert([orderPayload]).select("id").maybeSingle();
        
        if (ordErr) {
          debugLog("ORDER INSERT ERROR: " + JSON.stringify(ordErr));
          debugLog("Error message: " + ordErr.message);
          debugLog("Error details: " + ordErr.details);
          debugLog("Error hint: " + ordErr.hint);
          debugLog("Error code: " + ordErr.code);
          throw new Error("Order Save Error: " + (ordErr.message || ordErr.details || ordErr.hint || "Unknown insert error"));
        }
        
        debugLog("Order inserted successfully! ID: " + newOrder.id);
        
        // Rush fee adjustment
        if (newOrder && newOrder.id && currentPricing && currentPricing.rush_fee > 0) {
          const daysOut = getDaysFromToday(pickup_delivery_date);
          if (daysOut !== null && daysOut >= 0 && daysOut <= 10) {
            try {
              debugLog("Adding rush fee adjustment...");
              await sb.from("order_adjustments").insert([{
                order_id: newOrder.id,
                label: "Rush fee",
                amount: currentPricing.rush_fee,
                kind: "fee"
              }]);
              debugLog("Rush fee added");
            } catch (adjErr) {
              debugLog("Order adjustment insert failed (non critical): " + adjErr.message);
            }
          }
        }
        
        // Success
        debugLog("===== ORDER SUBMISSION COMPLETE =====");
        messageEl.textContent = "Thank you! Your request has been submitted.";
        messageEl.classList.add("success");
        document.getElementById("orderForm").reset();
        setTimeout(() => {
          window.location.href = "https://rebelribbon.com/thanks.html";
        }, 1500);
        
      } catch (err) {
        debugLog("===== ERROR IN SUBMISSION =====");
        debugLog("Error type: " + err.constructor.name);
        debugLog("Error message: " + err.message);
        debugLog("Error stack: " + err.stack);
        console.error("FULL ERROR OBJECT:", err);
        messageEl.textContent = "Error: " + err.message;
        messageEl.classList.add("error");
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = "Submit Order Request";
        updateEstimate();
      }
    }
    
    // DOMContentLoaded
    document.addEventListener("DOMContentLoaded", function() {
      debugLog("DOM Content Loaded");
      init();
      
      const pickupDateInput = document.getElementById("pickup_delivery_date");
      const eventDateInput = document.getElementById("event_date");
      const baseMinDateStr = getRelativeDateStr(5);
      debugLog("Min date set to: " + baseMinDateStr);
      
      if (pickupDateInput) pickupDateInput.min = baseMinDateStr;
      if (eventDateInput) eventDateInput.min = baseMinDateStr;
      
      if (pickupDateInput) {
        pickupDateInput.addEventListener("change", function() {
          if (eventDateInput && pickupDateInput.value) eventDateInput.min = pickupDateInput.value;
          updateEstimate();
        });
        pickupDateInput.addEventListener("input", updateEstimate);
      }
      
      if (eventDateInput) eventDateInput.addEventListener("input", updateEstimate);
      
      document.getElementById("gift_note").addEventListener("change", function() {
        document.getElementById("gift_note_text_group").style.display = this.checked ? "block" : "none";
        updateEstimate();
      });
      
      document.getElementById("pickup_delivery_type").addEventListener("change", function() {
        updateAddressVisibility();
        updateEstimate();
      });
      
      document.getElementById("cookie_amount_dzns").addEventListener("input", updateEstimate);
      document.getElementById("consultation_requested").addEventListener("change", updateEstimate);
      document.getElementById("applyDiscountButton").addEventListener("click", applyDiscount);
      document.getElementById("applyReferralButton").addEventListener("click", applyReferral);
      document.getElementById("orderForm").addEventListener("submit", handleOrderSubmit);
      
      updateAddressVisibility();
      updateEstimate();
      
      debugLog("All event listeners attached");
    });
  </script>

</body>
</html>
